<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cozinheiro Inteligente - Gemini AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos customizados para o gradiente e a anima√ß√£o do background */
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .animated-gradient {
            background: linear-gradient(-45deg, #e0f2f1, #c4b5fd, #818cf8);
            background-size: 400% 400%;
            animation: gradient-shift 15s ease infinite;
        }
        #receita-resultado {
            white-space: pre-wrap;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.95rem;
            min-height: 100px;
        }
        /* Estilo para a anima√ß√£o do bot√£o de carregamento */
        .cooking-pulse {
            animation: pulse-grow 1s infinite;
        }
        @keyframes pulse-grow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="animated-gradient flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-3xl bg-white/95 backdrop-blur-sm shadow-2xl rounded-xl p-8 border border-indigo-100/50 transform transition duration-500 hover:scale-[1.01]">
        <h1 class="text-4xl font-extrabold text-center text-indigo-700 mb-6 border-b-4 border-indigo-300 pb-3">
            üç≥ Cozinheiro Inteligente <span class="text-xl text-gray-500">(Gemini AI)</span>
        </h1>
        <p class="text-center text-gray-600 mb-8 font-medium">
            Seu assistente culin√°rio que transforma o que voc√™ tem em casa em obras-primas.
        </p>

        <div id="form-container" class="space-y-6">
            <label for="ingredientes" class="block text-xl font-bold text-gray-800">
                Quais ingredientes voc√™ tem?
            </label>
            <input type="text" id="ingredientes"
                   placeholder="Ex: p√£o, ovo, carne, queijo, tomate (separados por v√≠rgula)"
                   class="mt-1 block w-full px-5 py-3 border-2 border-indigo-200 rounded-xl shadow-lg text-lg focus:ring-indigo-600 focus:border-indigo-600 transition duration-300">

            <button id="gerar-btn"
                    class="w-full flex items-center justify-center py-3 px-4 rounded-xl shadow-xl text-xl font-bold text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition duration-150 ease-in-out transform active:scale-95">
                Gerar Receitas
            </button>
        </div>

        <div id="resultado-container" class="mt-12 pt-6 border-t border-indigo-100">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                Resultado:
            </h2>

            <div id="loading" class="text-center hidden p-8 bg-indigo-50 rounded-xl shadow-inner cooking-pulse">
                <svg class="animate-bounce h-8 w-8 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 4a2 2 0 100 4m0-4v4m0 4a2 2 0 100 4m0-4v4m0-12a8 8 0 100 16 8 8 0 000-16z" />
                </svg>
                <p class="text-indigo-600 mt-3 font-bold text-lg">A Chef IA est√° cozinhando algo delicioso...</p>
            </div>

            <div id="receita-resultado" class="text-gray-700 p-6 bg-white border-2 border-gray-200 rounded-xl shadow-md transition duration-300 min-h-[50px]">
                <p class="text-gray-400 italic">As sugest√µes de receita aparecer√£o aqui ap√≥s a gera√ß√£o.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Localize os elementos HTML
            const ingredienteInput = document.getElementById('ingredientes');
            const gerarBtn = document.getElementById('gerar-btn');
            const loadingIndicator = document.getElementById('loading');
            const resultadoDiv = document.getElementById('receita-resultado');

            // FUN√á√ÉO DE EFEITO DE DIGITA√á√ÉO
            function typeEffect(element, text, delay = 15) {
                return new Promise(resolve => {
                    let i = 0;
                    element.innerHTML = '';
                    function typing() {
                        if (i < text.length) {
                            element.innerHTML += text.charAt(i);
                            // Rola a tela para baixo conforme o texto cresce
                            resultadoDiv.scrollTop = resultadoDiv.scrollHeight;
                            i++;
                            setTimeout(typing, delay);
                        } else {
                            resolve();
                        }
                    }
                    typing();
                });
            }

            // Fun√ß√£o para enviar dados ao Flask
            async function enviarIngredientes() {
                const ingredientes = ingredienteInput.value.trim();

                if (!ingredientes) {
                    alert("Por favor, liste os ingredientes para gerar a receita.");
                    return;
                }

                // 1. Estados Visuais
                loadingIndicator.classList.remove('hidden');
                resultadoDiv.innerHTML = '';
                gerarBtn.disabled = true;
                resultadoDiv.classList.remove('border-red-500', 'border-green-500');
                resultadoDiv.classList.add('border-2');
                gerarBtn.innerHTML = 'Cozinhando...'; // Anima√ß√£o no bot√£o
                gerarBtn.classList.add('cooking-pulse'); // Adiciona pulsa√ß√£o

                try {
                    // 2. Enviar a requisi√ß√£o POST
                    const response = await fetch('/gerar_receita', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ingredientes: ingredientes }),
                    });

                    const data = await response.json();

                    // 3. Processar a resposta
                    if (response.ok) {
                        // Se a API retornar sucesso:
                        resultadoDiv.classList.add('border-green-500');

                        // Aplica o efeito de digita√ß√£o
                        const receitaTexto = data.receita || "Nenhuma receita gerada.";
                        await typeEffect(resultadoDiv, receitaTexto);

                    } else {
                        // Tratar Erro
                        const errorMessage = data.error || 'Ocorreu um erro desconhecido.';
                        resultadoDiv.innerHTML = `<p class="text-red-600 font-semibold">Erro do Servidor: ${errorMessage}</p>`;
                        resultadoDiv.classList.add('border-red-500');
                    }
                } catch (error) {
                    // Erro de Conex√£o
                    resultadoDiv.innerHTML = `<p class="text-red-600 font-semibold">Erro de Conex√£o: O servidor Flask parece estar offline.</p>`;
                    resultadoDiv.classList.add('border-red-500');
                    console.error('Erro na requisi√ß√£o:', error);
                } finally {
                    // 4. Resetar Estados Visuais
                    loadingIndicator.classList.add('hidden');
                    gerarBtn.disabled = false;
                    gerarBtn.innerHTML = 'Gerar Receitas';
                    gerarBtn.classList.remove('cooking-pulse');
                }
            }

            // Event Listener
            gerarBtn.addEventListener('click', enviarIngredientes);
        });
    </script>
</body>
</html>